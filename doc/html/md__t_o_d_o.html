<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MO53-TD: TODO list</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MO53-TD
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">TODO list </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Cette liste pourra vous guider dans le choix des étapes de refactoring en présentant les refactoring majeurs à faire sur le code.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Rendre la liste chaînée compatible avec les appels du vector</h1>
<p >Cette tâche doit permettre d'utiliser la liste comme le vecteur. Pour le permettre, il est nécessaire :</p><ul>
<li>de renommer <code>add_value</code> en <code>push_back</code></li>
<li>de renommer <code>clear_list</code> en <code>clear</code></li>
<li>d'ajouter un iterateur à la classe, ainsi que les méthodes <code>begin</code> et <code>end</code> permettant de parcourir la liste, ainsi que l'opérateur <code>++</code> pour ces itérateurs.</li>
<li>d'ajouter l'opérateur <code>[]</code> pour accéder à une valeur par sa position.</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Utilisation d'un manager pour les ressources</h1>
<p >Le manager est responsable de créer des objets, et de gérer leur cycle de vie. Le manager peut notamment avoir plusieurs factory pour les différents rôles (sources de données, type de stockage, sortie, type de calcul à effectuer)</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Injection de dépendances</h1>
<p >Jusqu'à cette tâche, les modifications ne changent pas réellement le fonctionnement du programme. À partir de cette étape, on va rendre le programme plus facile à modifier et à tester. L'idée est d'avoir un flux de type lire -&gt; stocker -&gt; traiter -&gt; écrire où chaque étape peut être paramétrée en injectant l'objet requis dans le flux. Un nouvel objet va donc être nécessaire, ainsi que des interfaces pour chaque rôle. Une bonne illustration pourrait être le code suivant :</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    <a class="code hl_class" href="classstorage__type.html">storage_type</a> storage; <span class="comment">// change storage type if required</span></div>
<div class="line">    storage = load_bin(path_to_file); <span class="comment">// change load_bin to load_text for text source</span></div>
<div class="line">    <a class="code hl_class" href="classstorage__type.html">storage_type</a> compute_result = <a class="code hl_class" href="classaverage.html">average</a>(storage); <span class="comment">// change function name to change behaviour</span></div>
<div class="line">    write_text(compute_result); <span class="comment">// change to write_bin to output in bin, to display for screen output</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassaverage_html"><div class="ttname"><a href="classaverage.html">average</a></div><div class="ttdoc">Class that calculate the average of storage_type.</div><div class="ttdef"><b>Definition:</b> calculation.h:26</div></div>
<div class="ttc" id="aclassstorage__type_html"><div class="ttname"><a href="classstorage__type.html">storage_type</a></div><div class="ttdoc">Abstract class (pure virtual) that define the behavior of a storage class.</div><div class="ttdef"><b>Definition:</b> storage_type.h:19</div></div>
<div class="ttc" id="amain_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> main.cpp:7</div></div>
</div><!-- fragment --><p >Le code si dessus est inutilement complexe, difficile à maintenir, à flexibiliser et à tester. Un bon code serait semblable à :</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_class" href="classstorage__type.html">storage_type</a> { <span class="comment">// pure virtual</span></div>
<div class="line">    <span class="comment">/* Declarations */</span></div>
<div class="line">};</div>
<div class="line"><span class="comment">// list_storage, vector_storage inherit from storage_type</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classloader.html">loader</a> { <span class="comment">// pure virtual</span></div>
<div class="line">}; <span class="comment">// as for storage_type, text and bin loaders are children of loader</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classcalculation.html">calculation</a> { <span class="comment">// pure virtual</span></div>
<div class="line">}; <span class="comment">// average, rolling_average, etc. inherit from calculation</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classwriter.html">writer</a> { <span class="comment">// pure virtual</span></div>
<div class="line">}; <span class="comment">// any output (file - text or bin, screen) inherit from this one</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classprocess.html">process</a> { <span class="comment">// raw pointers may be improved</span></div>
<div class="line">    <a class="code hl_class" href="classstorage__type.html">storage_type</a> *_storage;</div>
<div class="line">    <a class="code hl_class" href="classloader.html">loader</a> *_loader;</div>
<div class="line">    <a class="code hl_class" href="classcalculation.html">calculation</a> *_calc;</div>
<div class="line">    <a class="code hl_class" href="classwriter.html">writer</a> *_writer;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a class="code hl_function" href="classprocess.html#a86eb2d6e61399e58e85d4e42974d3b6b">process</a>(<a class="code hl_class" href="classstorage__type.html">storage_type</a> *stor, <a class="code hl_class" href="classloader.html">loader</a> *load, <a class="code hl_class" href="classcalculation.html">calculation</a> *calc, <a class="code hl_class" href="classwriter.html">writer</a> *write);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classprocess.html#a86db3fe5f9bd3f55d39ca6957bd25281">execute</a>();</div>
<div class="line">};</div>
<div class="ttc" id="aclasscalculation_html"><div class="ttname"><a href="classcalculation.html">calculation</a></div><div class="ttdoc">Abstract class (pure virtual) that define the behavior of a calculation class.</div><div class="ttdef"><b>Definition:</b> calculation.h:19</div></div>
<div class="ttc" id="aclassloader_html"><div class="ttname"><a href="classloader.html">loader</a></div><div class="ttdoc">Abstract class (pure virtual) that define the behavior of a loader class.</div><div class="ttdef"><b>Definition:</b> loader.h:19</div></div>
<div class="ttc" id="aclassprocess_html"><div class="ttname"><a href="classprocess.html">process</a></div><div class="ttdoc">Manage the data flux process.</div><div class="ttdef"><b>Definition:</b> process.h:24</div></div>
<div class="ttc" id="aclassprocess_html_a86db3fe5f9bd3f55d39ca6957bd25281"><div class="ttname"><a href="classprocess.html#a86db3fe5f9bd3f55d39ca6957bd25281">process::execute</a></div><div class="ttdeci">void execute()</div><div class="ttdoc">Makes the calls to the different stages of the data flux.</div></div>
<div class="ttc" id="aclassprocess_html_a86eb2d6e61399e58e85d4e42974d3b6b"><div class="ttname"><a href="classprocess.html#a86eb2d6e61399e58e85d4e42974d3b6b">process::process</a></div><div class="ttdeci">process(storage_type *stor, loader *load, calculation *calc, writer *write)</div><div class="ttdoc">Construct a new process object.</div><div class="ttdef"><b>Definition:</b> process.cpp:3</div></div>
<div class="ttc" id="aclasswriter_html"><div class="ttname"><a href="classwriter.html">writer</a></div><div class="ttdoc">Abstract class (pure virtual) that define the behavior of a writer class.</div><div class="ttdef"><b>Definition:</b> writer.h:19</div></div>
</div><!-- fragment --><p >Simplement, le manager crée (grâce aux factories), une instance de chaque élément nécessaire (il pourrait y en avoir plus ou moins), puis instancie un objet de type process auquel chaque instance des éléments requis. Puis, le main appelle la méthode <code>execute</code> qui réalise les appels aux différentes étapes :</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classprocess.html#a86db3fe5f9bd3f55d39ca6957bd25281">process::execute</a>() {</div>
<div class="line">    <span class="comment">// /!\ Think of checking for nullptr first</span></div>
<div class="line">    *_storage = _loader-&gt;load(path_to_file);</div>
<div class="line">    _calc-&gt;compute(_storage);</div>
<div class="line">    _writer-&gt;write(_storage);</div>
<div class="line">}</div>
</div><!-- fragment --><p >Et dans le main :</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    resource_manager mgr{};</div>
<div class="line">    <span class="comment">// Next line can be parameterized</span></div>
<div class="line">    <a class="code hl_class" href="classprocess.html">process</a> p{mgr.make_storage(LIST),</div>
<div class="line">              mgr.make_reader(BIN),</div>
<div class="line">              mgr.make_calculation(AVG),</div>
<div class="line">              mgr.make_writer(TEXT)};</div>
<div class="line">    p.<a class="code hl_function" href="classprocess.html#a86db3fe5f9bd3f55d39ca6957bd25281">execute</a>();</div>
<div class="line">    mgr.clear_resources();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p >Avec une implémentation correcte (attention aux pointeurs natifs, à RAII, etc.), le programme devrait pouvoir s'exécuter avec des paramètres différents sans problème et sans fuite mémoire (tester avec valgrind).</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Ajout de tests</h1>
<p >Les dépendances du programme étant injectées et donc construites en dehors du flux d'exécution de l'algorithme, tout peut maintenant être testé plus facilement. À l'aide de l'API cppunit, ajouter des tests unitaires sur vos classes. Pour tester les fonctions de calcul, il est maintenant facile de construire des objets de type <code><a class="el" href="classstorage__type.html" title="Abstract class (pure virtual) that define the behavior of a storage class.">storage_type</a></code> pour les passer en paramètre des fonctions de calcul et vérifier le résultat.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Ajout de commentaires</h1>
<p >Avec une syntaxe doxygen, écrire les commentaires des classes et des fonctions pour générer la documentation du code. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
